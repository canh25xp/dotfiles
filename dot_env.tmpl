#!/usr/bin/env sh

# Enable loading of secret files via `chezmoi secret`.
export CHEZMOI_SECRETS=1

# Determine the base token directory
TOKEN_BASE_DIR={{ if .work -}} "work/tokens" {{- else if .personal -}} "personal/tokens" {{- else -}} "tokens" {{- end }}

# Helper to export a key and announce it.
export_key() {
    var_name=$1
    secret_path=$2
    export "$var_name=$(pass show "$secret_path")"
    echo "env+ $var_name"
}

if [ "$1" ]; then
    case "$1" in
    openai) export_key OPENAI_API_KEY "$TOKEN_BASE_DIR/openai/codex" ;;
    ollama) export_key OLLAMA_API_KEY "$TOKEN_BASE_DIR/ollama/ollama" ;;
    gemini) export_key GEMINI_API_KEY "$TOKEN_BASE_DIR/gemini/gemini-cli" ;;
    openrouter) export_key OPENROUTER_API_KEY "$TOKEN_BASE_DIR/openrouter" ;;
    anthropic) export_key ANTHROPIC_API_KEY "$TOKEN_BASE_DIR/anthropic" ;;
    github) export_key GITHUB_TOKEN "$TOKEN_BASE_DIR/github/gh-cli" ;;
    quay) export_key QUAY_ENCRYPTED_PASSWORD "$TOKEN_BASE_DIR/quay/podman" ;;
    context) export_key CONTEXT7_API_KEY "$TOKEN_BASE_DIR/context7/mcp" ;;
    *) echo "Unknown API key specified." ;;
    esac
else
    export_key OLLAMA_API_KEY "$TOKEN_BASE_DIR/ollama/ollama"
    export_key OPENAI_API_KEY "$TOKEN_BASE_DIR/openai/codex"
    export_key GEMINI_API_KEY "$TOKEN_BASE_DIR/gemini/gemini-cli"
    export_key OPENROUTER_API_KEY "$TOKEN_BASE_DIR/openrouter"
    export_key ANTHROPIC_API_KEY "$TOKEN_BASE_DIR/anthropic"
    export_key GITHUB_TOKEN "$TOKEN_BASE_DIR/github/gh-cli"
    export_key QUAY_ENCRYPTED_PASSWORD "$TOKEN_BASE_DIR/quay/podman"
    export_key CONTEXT7_API_KEY "$TOKEN_BASE_DIR/context7/mcp"
fi
